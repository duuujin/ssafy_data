# DAG 스케줄
- DAG 실행을 이해하려면 Airflow의 start_date, logical_date, schedule_interval, data_interval 등의 시간 개념을 정확히 이해해야 함

## start_date
    - DAG이 처리하기 시작할 때 데이터의 기준 시점
    - 첫 번째 data_interval의 시작점을 정의함
    - DAG은 start_date 직후에 실행되지 않고, 해당 구간이 끝난 후에 처음 실행됨
    - 예 : start_date = 2025-01-01 -> 첫 실행은 2025-01-02 00:00에 발생
    - 주의 : start_date는 미래 시점으로 설정하지 말아야 하며, 미래 시점으로 설정하면 DAG이 예상대로 실행되지 않을 수 있음

## logical date
    - 각 DAG run을 식별하는 논리적 날짜
    - data_interval_start와 동일하며, 어떤 데이터를 처리하는 run인지 나타냄
    - 실제 실행 시간과는 다름(예 : logical_date=1월1일 -> 실행은 1월2일 00:00 이후)

## logical date 에시
- DAG가 매일 실행되는 경우(Schedule_interval = "@daily")

| Logical Date | DAG이 실행되는 실제 시간 (run_at) |
| :--- | :--- |
| **2025-03-01** | 2025-03-02 00:00:00 |
| **2025-03-02** | 2025-03-03 00:00:00 |
| **2025-03-03** | 2025-03-04 00:00:00 |

- Logical Date가 2025-03-01이면, DAG는 2025-03-02에 실행됨
- 항상 Logical Date보다 늦게 실행되므로 데이터 정합성을 유지하는데 중요함
- 즉, 데이터가 모두 적재된 이후에 실행되므로 데이터 정합성을 보장


## schedule_interval(스케줄 간격)
    - DAG이 실행되는 주기를 결정하는 설정값
    - DAG이 얼마나 자주 실행될지를 정의하는 간격
    - Cron 표현식 또는 예약어를 사용하여 주기를 정의
    - DAG 실행 주기가 DAG의 Execution Date를 결정함

## Schedule_interval 설정 방법

| 설정 값 | 설명 |
| :--- | :--- |
| **None** | 수동 실행 (자동 실행 없음) |
| **@Once** | DAG을 한 번만 실행 |
| **@hourly** | 매시간 실행 |
| **@daily** | 매일 자정(00:00)에 실행 |
| **@weekly** | 매주 일요일 00:00 실행 |
| **@monthly** | 매월 1일 00:00 실행 |
| **@yearly** | 매년 1월 1일 00:00 실행 |
| **"0 12 * * *"** | 매일 12시 정각 실행 (cron 표현식 사용 가능) |

- Cron 표현식을 사용하여 맞춤형 실행 주기 설정 가능
- Schedule_interval=None 설정 시 DAG는 자동 실행되지 않음

## Cron Schedule 표현
    - 30 5 * * * : 매일 05시 30분
    - 0 * * * * : 매시 정각
    - 1 * * * * : 매시 1분
    - 0 0 10 * * : 매월 10일 0시 0분
    - 30 9 * * 0 : 매주 일요일 09시 30분
    - */5 * * * * : 5분마다 (0분, 5분)(/ 특수 문자는 증가값 지정을 의미)
    - 0 9-15/1 * * * : 09시부터 15시까지 1시간 마다
    - 30 23 L * * : 매월 마지막 일 23시 30분에 배치
    - 0 9 * * 3#4 : 매월 4번째 수요일 9시 0분에 배치

## 빈도 설정
    - cron 식은 특정 빈도로 스케줄을 정의할 수 없음(3일에 한 번 실행 등)
    - timedelta 인스턴스를 사용해 빈도 기반 스케줄을 정의

# Backfill 이란?
- 특정 과거 Execution Date에 대해 DAG를 수동 실행하여 데이터 복구하는 작업
- 과거 실행이 누락되었거나, 데이터 오류가 발생했을 때 필요
- airflow dags backfill 명령어를 사용하여 특정 날짜 범위의 DAG 실행 가능

# Catchup이란?
- DAG 시작 날짜(start_date) 이후 누락된 실행을 보완하기 위해 과거의 Execution Date를 채우는 기능
- Catchup=True 설정 시, 과거 미실행 DAG를 자동으로 실행하여 누락된 데이터를 처리
- Catchup=False 설정 시, DAG 가장 최신 실행 시간부터만 실행됨

# 수동 실행 VS 자동 실행
- DAG이 얼마나 자주 실행될지를 정의하는 간격
- 자동 실행은 스케줄러가 주기적으로 워크플로우를 관리 -> 안정적 운영 중심
- 수동 실행은 운영자나 개발자가 직접 트리거 -> 테스트, 장애 복구, 백필 등에 활용
- 수동 실행 시에도 logical_date는 존재하나, 스케줄 기반 게산이 아니므로 데이터 기준 구간과 어긋날 수 있음

| | 자동 실행 (Scheduler 기반) | 수동 실행 (Manual Trigger) |
| :--- | :--- | :--- |
| **실행 시점** | data_interval이 끝난 후 자동 실행 | 사용자가 즉시 실행 |
| **Logical Date** | 스케줄에 따라 자동 계산 (예: 2025-03-01) | 기본값: 트리거 시각 (직접 지정 가능) |
| **Data Interval** | 스케줄에 따라 자동 생성 (3/1 00:00 ~ 3/2 00:00) | 현재 시각 중심으로 생성됨 |
| **데이터 정합성** | 데이터가 모두 적재된 뒤 실행되어 정합성 보장 | 수집 중 데이터 포함 가능하며 정합성 깨질 수 있음 |
| **활용 목적** | 정기 워크플로우 운영 | 테스트, 긴급 실행, 백필(backfill) |
| **명령 방식** | Airflow Scheduler 자동 실행 | airflow dags trigger my_dag, web ui 수동 trigger 클릭 |